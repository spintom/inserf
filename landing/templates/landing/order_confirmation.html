{% extends 'landing/base.html' %}
{% load static %}

{% block title %}Pedido Confirmado - INSERF{% endblock %}

{% block content %}
<section class="section">
  <div class="container">
    <div class="has-text-centered mb-6">
      <span class="icon is-large has-text-success">
        <i class="fas fa-check-circle fa-3x"></i>
      </span>
      <h1 class="title is-2 mt-4" data-aos="fade-up">¡Pedido Confirmado!</h1>
      <p class="subtitle is-4 has-text-grey" data-aos="fade-up" data-aos-delay="100">
        Gracias por tu compra. Tu pedido ha sido recibido y está siendo procesado.
      </p>
    </div>
    
    <div class="box p-5 mb-5" data-aos="fade-up" data-aos-delay="200">
      <div class="columns">
        <div class="column is-6">
          <h3 class="title is-4 mb-4">Detalles del Pedido</h3>
          <p><strong>Número de Pedido:</strong> #{{ order.id }}</p>
          <p><strong>Fecha:</strong> {{ order.created_at|date:"d/m/Y H:i" }}</p>
          <p><strong>Estado:</strong> <span class="tag is-warning">{{ order.status|capfirst }}</span></p>
          <p><strong>Total:</strong> ${{ order.total_amount|floatformat:0 }}</p>
          
          {% if order.notes %}
            <div class="notification is-light is-info mt-4">
              <p><strong>Notas:</strong> {{ order.notes }}</p>
            </div>
          {% endif %}
        </div>
        
        <div class="column is-6">
          <h3 class="title is-4 mb-4">Información de Envío</h3>
          <p><strong>Empresa:</strong> {{ order.client.company_name }}</p>
          <p><strong>RUT:</strong> {{ order.client.tax_id }}</p>
          <p><strong>Dirección:</strong> {{ order.client.address }}</p>
          <p><strong>Teléfono:</strong> {{ order.client.phone }}</p>
          <p><strong>Email:</strong> {{ order.client.email }}</p>
        </div>
      </div>
    </div>
    
    <div class="box p-5 mb-5" data-aos="fade-up" data-aos-delay="300">
      <h3 class="title is-4 mb-4">Resumen de Productos</h3>
      
      <table class="table is-fullwidth is-striped is-hoverable">
        <thead>
          <tr>
            <th>Producto</th>
            <th>Variante</th>
            <th>Precio Neto</th>
            <th>IVA</th>
            <th>Precio Total</th>
            <th>Cantidad</th>
            <th>Subtotal Neto</th>
            <th>IVA Total</th>
            <th>Subtotal</th>
          </tr>
        </thead>
        <tbody>
          {% for item in order.items.all %}
          <tr>
            <td>
              <div class="is-flex is-align-items-center">
                <figure class="image is-48x48 mr-3">
                  {% if item.variant.product.image_url %}
                    <img src="{{ item.variant.product.image_url }}" alt="{{ item.variant.product.name }}" class="is-rounded">
                  {% else %}
                    <img src="{% static 'images/banner1.jpg' %}" alt="Imagen no disponible" class="is-rounded">
                  {% endif %}
                </figure>
                <div>
                  <p class="has-text-weight-bold">{{ item.variant.product.name }}</p>
                  <p class="has-text-grey is-size-7">{{ item.variant.product.brand }}</p>
                </div>
              </div>
            </td>
            <td>
              {% if item.variant_details %}
                {{ item.variant_details }}
              {% else %}
                {% if item.variant.has_variants %}
                  {{ item.variant.color }} / {{ item.variant.size }}
                {% else %}
                  Producto sin variantes
                {% endif %}
              {% endif %}
            </td>
            <td>${{ item.net_unit_price|floatformat:0 }}</td>
            <td>${{ item.vat_amount|floatformat:0 }}</td>
            <td>${{ item.unit_price|floatformat:0 }}</td>
            <td>{{ item.quantity }}</td>
            <td>${{ item.net_subtotal|floatformat:0 }}</td>
            <td>${{ item.vat_subtotal|floatformat:0 }}</td>
            <td class="has-text-weight-bold">${{ item.subtotal|floatformat:0 }}</td>
          </tr>
          {% endfor %}
        </tbody>
        <tfoot>
          <tr>
            <th colspan="6" class="has-text-right">Totales:</th>
            <th>${{ order.net_total|floatformat:0 }}</th>
            <th>${{ order.vat_total|floatformat:0 }}</th>
            <th class="has-text-primary">${{ order.total_amount|floatformat:0 }}</th>
          </tr>
        </tfoot>
      </table>
    </div>
    
    <div class="notification is-info is-light mb-5" data-aos="fade-up" data-aos-delay="400">
      <div class="columns is-vcentered">
        <div class="column is-1 has-text-centered">
          <span class="icon is-large">
            <i class="fas fa-info-circle fa-2x has-text-info"></i>
          </span>
        </div>
        <div class="column">
          <p>Recibirás un correo electrónico con los detalles de tu pedido y las instrucciones para realizar el pago.</p>
          <p class="mt-2">Si tienes alguna pregunta sobre tu pedido, contáctanos a <a href="mailto:contacto@inserf.cl">contacto@inserf.cl</a>.</p>
        </div>
      </div>
    </div>
    
    <div class="has-text-centered" data-aos="fade-up" data-aos-delay="500">
      <a href="{% url 'landing:my_orders' %}" class="button is-primary">
        <span class="icon">
          <i class="fas fa-shopping-bag"></i>
        </span>
        <span>Ver Mis Pedidos</span>
      </a>
      <a href="{% url 'landing:catalog' %}" class="button is-light ml-2">
        <span class="icon">
          <i class="fas fa-fish"></i>
        </span>
        <span>Volver al Catálogo</span>
      </a>
    </div>
  </div>
</section>
{% endblock %}